/* ===== Top bar ===== */
.topbar{
  position:fixed;
  top:0; left:0; right:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 18px 18px 14px;
  gap:12px;
  z-index: 20;
  pointer-events:none;
}
.topbar > *{ pointer-events:auto; }

.brand .logo{
  font-size: clamp(34px, 3.6vw, 52px);
  font-weight: 700;
  letter-spacing: .02em;
}
.logoStar{ color: rgba(233,238,255,.85); }
.subtitle{
  margin-top: 4px;
  color: var(--muted);
  letter-spacing: .28em;
  font-size: 12px;
}

.topControls{
  display:flex;
  align-items:center;
  gap:10px;
}

.zoomBox{
  position: fixed;
  right: 20px;
  bottom: 20px;

  display:flex;
  align-items:center;
  gap:8px;
  padding: 8px 10px;

  border: 1px solid var(--border);
  background: rgba(0,0,0,.35);
  border-radius: 999px;
  backdrop-filter: blur(10px);

  z-index: 30;
}

#zoomSlider{ width: 160px; }

/* ===== Layout ===== */
.layout{
  height:100%;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap: 14px;
  padding: 120px 14px 14px; /* ← 76px から増やす */
}

#map {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

#bg-stars,
#wires,
#nodes {
  position: absolute;
  inset: 0;
}

#wires {
  pointer-events: none;
}
.hint{
  position:absolute;
  left: 14px;
  bottom: 12px;
  font-size: 12px;
  color: var(--muted);
  opacity: .85;
  z-index: 5;
}

/* ===== World (pan/zoom target) ===== */
.world{
  position:absolute;
  inset:0;
  transform-origin: 0 0;
}

.wires{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  overflow:visible;
}

.nodes{
  position:absolute;
  inset:0;
}

/* ===== Node ===== */
.node{
  position:absolute;
  transform: translate(-50%, -50%);
  user-select:none;
  cursor:pointer;
  z-index: 3;
}

.node .dot{
  width: 14px;
  height: 14px;
  border-radius: 999px;
  background: var(--p1);
  box-shadow: 0 0 18px rgba(255,255,255,.35);
  position: relative;
  transition: box-shadow .22s ease, filter .22s ease, transform .22s ease;
}

.node .label{
  margin-top: 6px;
  text-align:center;
  font-size: 11px;
  color: rgba(233,238,255,.85);
  text-shadow: 0 6px 14px rgba(0,0,0,.55);
  max-width: 140px;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}

/* click glow */
.node.selected .dot{
  filter: brightness(1.12);
  box-shadow:
    0 0 0 4px rgba(122,162,255,.22),
    0 0 26px rgba(122,162,255,.55),
    0 0 80px rgba(122,162,255,.25);
}

.node.selected .dot::after{
  content:"";
  position:absolute;
  inset:-16px;
  border-radius:999px;
  pointer-events:none;

  box-shadow:
    0 0 0 6px rgba(122,162,255,.10),
    0 0 40px rgba(122,162,255,.35),
    0 0 120px rgba(122,162,255,.18);

  animation: selectedBreath 2.8s ease-in-out infinite;
}

@keyframes selectedBreath{
  0%   { transform: scale(.92); opacity:.45; }
  50%  { transform: scale(1.14); opacity:.95; }
  100% { transform: scale(.92); opacity:.45; }
}

/* Priority colors */
.node.p1 .dot{ background: var(--p1); }
.node.p2 .dot{ background: var(--p2); }
.node.p3 .dot{ background: var(--p3); }
.node.p4 .dot{ background: var(--p4); }
.node.p5 .dot{ background: var(--p5); }

/* Priority5 heartbeat (stronger pulse) */
@keyframes pulse5{
  0%   { transform: scale(1);   filter: brightness(1); }
  45%  { transform: scale(1.18); filter: brightness(1.12); }
  100% { transform: scale(1);   filter: brightness(1); }
}
.node.p5 .dot{
  animation: pulse5 1.8s ease-in-out infinite;
}

/* ===== Completed (achieved) ===== */
.node.completed .dot{
  background: radial-gradient(circle at 30% 30%, rgba(170,220,255,.95), rgba(70,140,255,.85));
  box-shadow:
    0 0 0 5px rgba(90,170,255,.18),
    0 0 26px rgba(90,170,255,.60),
    0 0 70px rgba(90,170,255,.20);
  animation: none;
}

/* keep a clear focus ring when selected + completed */
.node.completed.selected .dot{
  box-shadow:
    0 0 0 4px rgba(122,162,255,.28),
    0 0 0 10px rgba(90,170,255,.14),
    0 0 28px rgba(90,170,255,.70),
    0 0 90px rgba(90,170,255,.22);
}

/* tiny sparkles around the dot (B plan) */
.node.completed .dot::before{
  content:"";
  position:absolute;
  inset:-18px;
  border-radius:999px;
  pointer-events:none;
  opacity:.75;

  background-image:
    radial-gradient(2px 2px at 18% 30%, rgba(210,240,255,.95) 0 60%, transparent 61%),
    radial-gradient(1.5px 1.5px at 70% 25%, rgba(190,230,255,.85) 0 60%, transparent 61%),
    radial-gradient(1.5px 1.5px at 82% 68%, rgba(210,240,255,.90) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 30% 78%, rgba(170,220,255,.80) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 55% 55%, rgba(230,250,255,.70) 0 60%, transparent 61%);
  filter: blur(.2px);
  animation: twinkle 3.2s ease-in-out infinite;
}

@keyframes twinkle{
  0%   { transform: rotate(0deg) scale(.98); opacity:.45; }
  40%  { opacity:.85; }
  60%  { transform: rotate(18deg) scale(1.02); opacity:.70; }
  100% { transform: rotate(0deg) scale(.98); opacity:.45; }
}

/* optional: label feels "complete" */
.node.completed .label{
  color: rgba(215,235,255,.90);
}


/* Me（Priorityより後に置いて上書きされないようにする） */
.node.me .dot{
  width: 22px;
  height: 22px;
  background: radial-gradient(circle at 30% 30%, var(--me2), var(--me1));
  box-shadow:
    0 0 0 7px rgba(90,150,255,.12),
    0 0 34px rgba(90,150,255,.55),
    0 0 90px rgba(90,150,255,.18);
  animation: none; /* p5の鼓動を無効化 */
}

/* もしJSが p5 を付けてしまっても、Meを勝たせる保険 */
.node.me.p5 .dot{
  background: radial-gradient(circle at 30% 30%, var(--me2), var(--me1));
  animation: none;
}

/* lines */
.wire{
  stroke: rgba(233,238,255,.22);
  stroke-width: 1;
}

/* ---- Selected node pulse ---- */

@keyframes pulseGlow {
  0% {
    transform: scale(1);
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
  }
  50% {
    transform: scale(1.12);
    box-shadow: 0 0 18px rgba(255,255,255,0.9);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
  }
}

.copyright{
  position:absolute;
  right:14px;
  bottom:12px;
  font-size:11px;
  color: rgba(233,238,255,.45);
  letter-spacing:.08em;
  z-index:5;
  pointer-events:none;
}

/* ===== Background stars (CSS only) ===== */
#bg-stars{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
  opacity:.85;

  background-image:
    /* 遠景（細かく多い） */
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.35) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 30% 70%, rgba(255,255,255,.30) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 60% 40%, rgba(255,255,255,.32) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,.28) 0 60%, transparent 61%),

    /* 中景 */
    radial-gradient(2px 2px at 25% 35%, rgba(255,255,255,.55) 0 60%, transparent 61%),
    radial-gradient(2px 2px at 75% 65%, rgba(255,255,255,.50) 0 60%, transparent 61%),
    radial-gradient(2px 2px at 45% 10%, rgba(255,255,255,.48) 0 60%, transparent 61%),

    /* 近景（少し増やす） */
    radial-gradient(3px 3px at 50% 20%, rgba(255,255,255,.85) 0 60%, transparent 61%),
    radial-gradient(3px 3px at 15% 85%, rgba(255,255,255,.80) 0 60%, transparent 61%);

  background-size:
    250px 250px, 250px 250px, 250px 250px, 250px 250px,
    450px 450px, 450px 450px, 450px 450px,
    750px 750px, 750px 750px;

  background-repeat: repeat;
  filter: blur(.45px);
}

/* 星屑 < world（線と星） */
.world{ z-index:1; }

/* ===== Mobile (m only) ===== */
@media (max-width: 900px){
.layout{
  grid-template-columns: 1fr;
  grid-template-rows: 44vh auto;
  padding: 96px 12px 12px;
  gap: 10px;
}

#map{
  outline: 6px solid hotpink;
}

  #map{
    height: 44vh;
    min-height: 240px;
  }

  .panel{
    max-height: calc(100vh - 44vh - 96px);
    overflow: auto;
  }

  .hint{
    left: 12px;
    right: 12px;
    bottom: 18px;
    font-size: 11px;
    opacity: .65;
  }

  .copyright{
    left: 12px;
    right: auto;
    bottom: 4px;
    font-size: 11px;
  }
}

