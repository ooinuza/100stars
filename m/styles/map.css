/* ===== Top bar ===== */
.topbar{
  position:fixed;
  top:0; left:0; right:0;
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  padding: 18px 18px 14px;
  gap:12px;
  z-index: 20;
  pointer-events:none;
}
.topbar > *{ pointer-events:auto; }

.brand .logo{
  font-size: clamp(32px, 4vw, 48px);
  font-weight: 700;
  letter-spacing: .02em;
}

.logoStar{ color: rgba(233,238,255,.85); }
.subtitle{
  font-size: 13px;
  letter-spacing: .3em;
  opacity: .8;
}

.topControls{
  display:flex;
  align-items:center;
  gap:10px;
}

.zoomBox{
  position: fixed;
  right: 20px;
  bottom: 20px;

  display:flex;
  align-items:center;
  gap:8px;
  padding: 8px 10px;

  border: 1px solid var(--border);
  background: rgba(0,0,0,.35);
  border-radius: 999px;
  backdrop-filter: blur(10px);

  z-index: 30;
}

#zoomSlider{ width: 160px; }

/* ===== Layout ===== */
.layout{
  height:100%;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap: 14px;
  padding: 108px 14px 14px; /* ← 76px → 108px くらいに */
}

#map {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

#bg-stars,
#wires,
#nodes {
  position: absolute;
  inset: 0;
}

#wires {
  pointer-events: none;
}
.hint{
  position:absolute;
  left: 14px;
  bottom: 12px;
  font-size: 12px;
  color: var(--muted);
  opacity: .85;
  z-index: 5;
}

/* ===== World (pan/zoom target) ===== */
.world{
  position:absolute;
  inset:0;
  transform-origin: 0 0;
}

.wires{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  overflow:visible;
}

.nodes{
  position:absolute;
  inset:0;
}

/* ===== Node ===== */
.node{
  position:absolute;
  transform: translate(-50%, -50%);
  user-select:none;
  cursor:pointer;
  z-index: 3;
}

.node .dot{
  width: 14px;
  height: 14px;
  border-radius: 999px;
  background: var(--p1);
  box-shadow: 0 0 18px rgba(255,255,255,.35);
  position: relative;
}

.node .label{
  margin-top: 6px;
  text-align:center;
  font-size: 11px;
  color: rgba(233,238,255,.85);
  text-shadow: 0 6px 14px rgba(0,0,0,.55);
  max-width: 140px;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}

/* click glow */
.node.selected .dot{
  box-shadow:
    0 0 0 4px rgba(122,162,255,.25),
    0 0 22px rgba(122,162,255,.55),
    0 0 48px rgba(122,162,255,.18);
}

/* pulseは別レイヤーで追加 */
.node.selected .dot::after{
  content:"";
  position:absolute;
  inset:-12px;
  border-radius:999px;
  pointer-events:none;

  box-shadow:
    0 0 0 6px rgba(122,162,255,.15),
    0 0 30px rgba(122,162,255,.35);

  animation: pulseHalo 2.4s ease-in-out infinite;
}

@keyframes pulseHalo{
  0%   { transform: scale(.9); opacity:.5; }
  50%  { transform: scale(1.15); opacity:1; }
  100% { transform: scale(.9); opacity:.5; }
}

/* Priority colors */
.node.p1 .dot{ background: var(--p1); }
.node.p2 .dot{ background: var(--p2); }
.node.p3 .dot{ background: var(--p3); }
.node.p4 .dot{ background: var(--p4); }
.node.p5 .dot{ background: var(--p5); }

/* Priority5 heartbeat (stronger pulse) */
@keyframes pulse5{
  0%   { transform: scale(1);   filter: brightness(1); }
  45%  { transform: scale(1.18); filter: brightness(1.12); }
  100% { transform: scale(1);   filter: brightness(1); }
}
.node.p5 .dot{
  animation: pulse5 1.8s ease-in-out infinite;
}

/* Me（Priorityより後に置いて上書きされないようにする） */
.node.me .dot{
  width: 22px;
  height: 22px;
  background: radial-gradient(circle at 30% 30%, var(--me2), var(--me1));
  box-shadow:
    0 0 0 7px rgba(90,150,255,.12),
    0 0 34px rgba(90,150,255,.55),
    0 0 90px rgba(90,150,255,.18);
  animation: none; /* p5の鼓動を無効化 */
}

/* もしJSが p5 を付けてしまっても、Meを勝たせる保険 */
.node.me.p5 .dot{
  background: radial-gradient(circle at 30% 30%, var(--me2), var(--me1));
  animation: none;
}

/* lines */
.wire{
  stroke: rgba(233,238,255,.22);
  stroke-width: 1;
}

/* ===== Background stars (CSS only) ===== */
#bg-stars{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
  opacity:.85;

  background-image:
    /* 遠景（細かく多い） */
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.35) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 30% 70%, rgba(255,255,255,.30) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 60% 40%, rgba(255,255,255,.32) 0 60%, transparent 61%),
    radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,.28) 0 60%, transparent 61%),

    /* 中景 */
    radial-gradient(2px 2px at 25% 35%, rgba(255,255,255,.55) 0 60%, transparent 61%),
    radial-gradient(2px 2px at 75% 65%, rgba(255,255,255,.50) 0 60%, transparent 61%),
    radial-gradient(2px 2px at 45% 10%, rgba(255,255,255,.48) 0 60%, transparent 61%),

    /* 近景（少し増やす） */
    radial-gradient(3px 3px at 50% 20%, rgba(255,255,255,.85) 0 60%, transparent 61%),
    radial-gradient(3px 3px at 15% 85%, rgba(255,255,255,.80) 0 60%, transparent 61%);

  background-size:
    250px 250px, 250px 250px, 250px 250px, 250px 250px,
    450px 450px, 450px 450px, 450px 450px,
    750px 750px, 750px 750px;

  background-repeat: repeat;
  filter: blur(.45px);
}

/* レイヤー順（bg-stars < wires < nodes） */
#wires { z-index: 1; }
#nodes { z-index: 2; }

/* コピーライト */
.copyright{
  position:absolute;
  right:14px;
  bottom:12px;
  font-size:11px;
  color: rgba(233,238,255,.45);
  letter-spacing:.08em;
  z-index:5;
  pointer-events:none;
}